{"version":3,"file":"kapsule.js","sources":["../node_modules/debounce/index.js","../src/index.js"],"sourcesContent":["/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing. The function also has a property 'clear' \n * that is a function which will clear the timer to prevent previously scheduled executions. \n *\n * @source underscore.js\n * @see http://unscriptable.com/2009/03/20/debouncing-javascript-methods/\n * @param {Function} function to wrap\n * @param {Number} timeout in ms (`100`)\n * @param {Boolean} whether to execute at the beginning (`false`)\n * @api public\n */\nfunction debounce(func, wait, immediate){\n  var timeout, args, context, timestamp, result;\n  if (null == wait) wait = 100;\n\n  function later() {\n    var last = Date.now() - timestamp;\n\n    if (last < wait && last >= 0) {\n      timeout = setTimeout(later, wait - last);\n    } else {\n      timeout = null;\n      if (!immediate) {\n        result = func.apply(context, args);\n        context = args = null;\n      }\n    }\n  };\n\n  var debounced = function(){\n    context = this;\n    args = arguments;\n    timestamp = Date.now();\n    var callNow = immediate && !timeout;\n    if (!timeout) timeout = setTimeout(later, wait);\n    if (callNow) {\n      result = func.apply(context, args);\n      context = args = null;\n    }\n\n    return result;\n  };\n\n  debounced.clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n  \n  debounced.flush = function() {\n    if (timeout) {\n      result = func.apply(context, args);\n      context = args = null;\n      \n      clearTimeout(timeout);\n      timeout = null;\n    }\n  };\n\n  return debounced;\n};\n\n// Adds compatibility for ES modules\ndebounce.debounce = debounce;\n\nmodule.exports = debounce;\n","import debounce from 'debounce';\n\nclass Prop {\n  constructor(name, {\n    default: defaultVal = null,\n    triggerUpdate = true,\n    onChange = (newVal, state) => {}\n  }) {\n    this.name = name;\n    this.defaultVal = defaultVal;\n    this.triggerUpdate = triggerUpdate;\n    this.onChange = onChange;\n  }\n}\n\nexport default function ({\n  stateInit = (() => ({})),\n  props: rawProps = {},\n  methods = {},\n  aliases = {},\n  init: initFn = (() => {}),\n  update: updateFn = (() => {})\n}) {\n\n  // Parse props into Prop instances\n  const props = Object.keys(rawProps).map(propName =>\n    new Prop(propName, rawProps[propName])\n  );\n\n  return function(options = {}) {\n\n    // Holds component state\n    let state = Object.assign({},\n      stateInit instanceof Function ? stateInit(options) : stateInit, // Support plain objects for backwards compatibility\n      { initialised: false }\n    );\n\n    // Component constructor\n    function comp(nodeElement) {\n      initStatic(nodeElement, options);\n      digest();\n\n      return comp;\n    }\n\n    const initStatic = function(nodeElement, options) {\n      initFn.call(comp, nodeElement, state, options);\n      state.initialised = true;\n    };\n\n    const digest = debounce(() => {\n      if (!state.initialised) { return; }\n      updateFn.call(comp, state);\n    }, 1);\n\n    // Getter/setter methods\n    props.forEach(prop => {\n      comp[prop.name] = getSetProp(prop.name, prop.triggerUpdate, prop.onChange);\n\n      function getSetProp(prop, redigest = false,  onChange = (newVal, state) => {}) {\n        return function(_) {\n          const curVal = state[prop];\n          if (!arguments.length) { return curVal } // Getter mode\n          state[prop] = _;\n          onChange.call(comp, _, state, curVal);\n          if (redigest) { digest(); }\n          return comp;\n        }\n      }\n    });\n\n    // Other methods\n    Object.keys(methods).forEach(methodName => {\n      comp[methodName] = (...args) => methods[methodName].call(comp, state, ...args);\n    });\n\n    // Link aliases\n    Object.entries(aliases).forEach(([alias, target]) => comp[alias] = comp[target]);\n\n    // Reset all component props to their default value\n    comp.resetProps = function() {\n      props.forEach(prop => {\n        comp[prop.name](prop.defaultVal);\n      });\n      return comp;\n    };\n\n    //\n\n    comp.resetProps(); // Apply all prop defaults\n    state._rerender = digest; // Expose digest method\n\n    return comp;\n  }\n}\n"],"names":["Prop","name","defaultVal","triggerUpdate","onChange","newVal","state","stateInit","props","rawProps","methods","aliases","init","initFn","update","updateFn","Object","keys","map","propName","options","assign","Function","initialised","comp","nodeElement","initStatic","digest","call","debounce","forEach","prop","getSetProp","redigest","_","curVal","arguments","length","methodName","args","entries","alias","target","resetProps","_rerender"],"mappings":"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"}